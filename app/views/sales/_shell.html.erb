<% content_for :sale_actions do %>
  <ul>
    <li>
      <h2
        class="
          menu-title px-4 py-2 opacity-50 text-xs font-bold uppercase
          tracking-wider
        "
      >
        <%= sale.product_name_snapshot %>
      </h2>

      <ul>
        <li>
          <%= active_link_to sale_path(sale), active: :exclusive do %>
            <%= icon("badge", size: 18) %>
            <%= t("sales.sidebar.details", default: "Panoramica") %>
          <% end %>
        </li>
      </ul>
    </li>
  </ul>
<% end %>

<% content_for :record_title do %>
  <span class="font-mono tracking-tight">
    <%= sale.product_name_snapshot %>
  </span>
<% end %>

<% content_for :record_subtitle do %>
  <div class="flex flex-wrap items-center gap-3 text-sm opacity-70">
    <%# Data Vendita %>
    <div class="badge badge-sm badge-ghost gap-1">
      <%= icon("event", size: 12) %>
      <%= format_date(sale.sold_on, format: :long) %>
    </div>

    <%# Acquirente (Linkabile al socio) %>
    <div class="flex items-center gap-1 hover:text-primary transition-colors">
      <%= icon("member", size: 14) %>
      <%= link_to sale.member.full_name, member_path(sale.member), class: "font-bold hover:underline" %>
    </div>

    <%# Stato Annullato %>
    <% if sale.discarded? %>
      <span class="badge badge-error badge-sm gap-1">
        <%= icon("close", size: 12) %> ANNULLATA
      </span>
    <% end %>
  </div>
<% end %>

<% content_for :record_actions do %>
  <div class="flex items-center gap-2">
    <% if sale.cash? && sale.kept? %>
      <%= link_to sale_path(sale, format: :pdf),
		  class: "btn btn-primary btn-sm gap-2",
		  target: "_blank" do %>
        <%= icon("print", size: 16) %> Stampa PDF
      <% end %>
    <% end %>

    <%# DROPDOWN AZIONI SECONDARIE %>
    <div class="dropdown dropdown-end">
      <div tabindex="0" role="button" class="btn btn-square btn-sm btn-ghost">
        <%= icon("more", size: 20) %>
      </div>

      <ul
        tabindex="0"
        class="
          dropdown-content menu bg-base-100 rounded-box z-[1] w-52 p-2
          shadow-lg border border-base-200
        "
      >
        <li>
          <%= link_to sale_path(sale), 
          class: "text-error hover:bg-error/10",
		      data: { turbo_method: :delete, turbo_confirm: "Sei sicuro di voler annullare questa transazione? Questa azione annullera' anche l'abbonamento collegato." } do %>
            <%= icon("delete", size: 16) %> Annulla Transazione
          <% end %>
        </li>
      </ul>
    </div>
  </div>
<% end %>

<%# Renderizza l'header standard (che usa i content_for qui sopra) %>
<%= render "shared/header/record" %>

<%# --- 3. CONTENUTO DELLA VIEW --- %>
<div class="mt-6"><%= yield %></div>
