<%= form_with(model: user, class: "space-y-6") do |f| %>
  <%= render "shared/form_errors", model: user %>

  <%# --- SEZIONE 1: IDENTITÀ --- %>
  <fieldset class="fieldset bg-base-100 border border-base-300 p-4 rounded-box shadow-sm">
    <legend class="fieldset-legend">
      <%= icon("badge", size: 14) %> Identità
    </legend>

    <%# RIGA 1: Nome e Cognome %>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full">
      <div>
        <%= f.label :first_name, "Nome", class: "label" %>
        <%= f.text_field :first_name, required: true, class: "input w-full", placeholder: "Mario" %>
      </div>

      <div>
        <%= f.label :last_name, "Cognome", class: "label" %>
        <%= f.text_field :last_name, required: true, class: "input w-full", placeholder: "Rossi" %>
      </div>
    </div>

    <%# RIGA 2: Username %>
    <div class="mt-2">
      <%= f.label :username, "Username", class: "label" %>
      <%= f.text_field :username, required: true, class: "input w-full", placeholder: "mario.rossi" %>

      <p class="label">
        <span class="label-text-alt text-base-content/60">Usato per il login. Solo lettere minuscole e numeri.</span>
      </p>
    </div>
  </fieldset>

  <%# --- SEZIONE 2: ACCESSO & SICUREZZA --- %>
  <fieldset class="fieldset bg-base-100 border border-base-300 p-4 rounded-box shadow-sm">
    <legend class="fieldset-legend">
      <%= icon("lock", size: 14) %> Accesso & Sicurezza
    </legend>

    <%# RIGA 1: Email e Ruolo %>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full">
      <div>
        <%= f.label :email_address, "Email", class: "label" %>
        <%= f.email_field :email_address, required: true, class: "input w-full", placeholder: "mario@palestra.it" %>
      </div>

      <div>
        <%= f.label :role, "Ruolo", class: "label" %>

        <%# LOGICA ADMIN: Disabilita se non è admin %>
        <%= f.select :role, 
            User.roles.keys.map { |r| [r.humanize, r] }, 
            {}, 
            class: "select w-full", 
            disabled: !current_user.admin? %>
      </div>
    </div>

    <div class="divider my-2"></div>

    <%# RIGA 2: Password %>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full">
      <div>
        <%= f.label :password, "Nuova Password", class: "label" %>
        <%= f.password_field :password, class: "input w-full", autocomplete: "new-password" %>
      </div>

      <div>
        <%= f.label :password_confirmation, "Conferma Password", class: "label" %>
        <%= f.password_field :password_confirmation, class: "input w-full", autocomplete: "new-password" %>
      </div>
    </div>

    <%# Hint Password (solo se edit) %>
    <% if user.persisted? %>
      <p class="label">
        <span class="label-text-alt text-base-content/60">
          <%= icon("info", size: 12, class: "inline mr-1") %>
          Lascia i campi password vuoti per mantenere quella attuale.
        </span>
      </p>
    <% end %>
  </fieldset>

  <%# --- AZIONI --- %>
  <div class="modal-action mt-8 flex items-center justify-end gap-2">
    <%= link_to "Annulla", users_path, class: "btn btn-ghost" %>

    <%= button_tag "Salva Utente", type: "submit",
		   class: "btn btn-primary",
		   data: { turbo_submits_with: '<span class="loading loading-dots loading-sm"></span> Salvataggio...' } %>
  </div>
<% end %>
