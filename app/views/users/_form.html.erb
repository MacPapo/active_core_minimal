<%= form_with(model: user, class: "space-y-6") do |f| %>
  <%= render "shared/form_errors", model: user %>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <%# SEZIONE 1: IDENTITÀ %>
    <div class="card bg-base-100 shadow-xl border border-base-200">
      <div class="card-body">
        <h3 class="card-title text-sm uppercase opacity-50 tracking-wider mb-2">
          Identità
        </h3>

        <div class="grid grid-cols-2 gap-4">
          <div class="form-control w-full">
            <%= f.label :first_name, "Nome", class: "label font-bold" %>
            <%= f.text_field :first_name, required: true, class: "input input-bordered w-full", placeholder: "Mario" %>
          </div>

          <div class="form-control w-full">
            <%= f.label :last_name, "Cognome", class: "label font-bold" %>
            <%= f.text_field :last_name, required: true, class: "input input-bordered w-full", placeholder: "Rossi" %>
          </div>
        </div>

        <div class="form-control w-full mt-2">
          <%= f.label :username, "Username", class: "label font-bold" %>
          <label class="input input-bordered flex items-center gap-2">
            <%= icon("alternate_email", size: 16, class: "opacity-70") %>
            <%= f.text_field :username, required: true, class: "grow", placeholder: "mario.rossi" %>
          </label>

          <div class="label">
            <span class="label-text-alt opacity-60">Usato per il login. Solo lettere minuscole e numeri.</span>
          </div>
        </div>
      </div>
    </div>

    <%# SEZIONE 2: ACCESSO & SICUREZZA %>
    <div class="card bg-base-100 shadow-xl border border-base-200">
      <div class="card-body">
        <h3 class="card-title text-sm uppercase opacity-50 tracking-wider mb-2">
          Accesso & Sicurezza
        </h3>

        <div class="form-control w-full">
          <%= f.label :email_address, "Email", class: "label font-bold" %>
          <%= f.email_field :email_address, required: true, class: "input input-bordered w-full", placeholder: "mario@palestra.it" %>
        </div>

        <div class="form-control w-full mt-2">
          <%= f.label :role, "Ruolo", class: "label font-bold" %>
          <%= f.select :role, 
              User.roles.keys.map { |r| [r.humanize, r] }, 
              {}, 
              class: "select select-bordered w-full" %>
        </div>

        <div class="divider text-xs opacity-50 my-2">Password</div>

        <% if user.persisted? %>
          <div class="alert alert-info text-xs py-2 mb-2 shadow-sm">
            <%= icon("info", size: 16) %>
            <span>Lascia i campi password vuoti per mantenere quella attuale.</span>
          </div>
        <% end %>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div class="form-control w-full">
            <%= f.label :password, "Nuova Password", class: "label font-bold" %>
            <%= f.password_field :password, class: "input input-bordered w-full", autocomplete: "new-password" %>
          </div>

          <div class="form-control w-full">
            <%= f.label :password_confirmation, "Conferma Password", class: "label font-bold" %>
            <%= f.password_field :password_confirmation, class: "input input-bordered w-full", autocomplete: "new-password" %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="flex justify-end gap-2">
    <%= link_to "Annulla", users_path, class: "btn btn-ghost" %>
    <%= f.button class: "btn btn-primary" do %>
      <%= icon("save", size: 20) %>
      Salva Utente
    <% end %>
  </div>
<% end %>
