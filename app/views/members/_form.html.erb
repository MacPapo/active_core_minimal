<%= form_with(model: member, class: "space-y-6") do |f| %>
  <%= render "shared/form_errors", model: member %>

  <%# --- SEZIONE 1: DATI ANAGRAFICI --- %>
  <fieldset class="fieldset bg-base-100 border border-base-300 p-4 rounded-box shadow-sm">
    <legend class="fieldset-legend">
      <%= icon("badge", size: 14) %>
      <%= t("members.form.sections.personal", default: "Dati Anagrafici") %>
    </legend>

    <%# RIGA 1: Nome e Cognome %>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full">
      <div>
        <%= f.label :first_name, class: "label" %>
        <%= f.text_field :first_name, required: true, class: "input w-full", placeholder: "Mario" %>
      </div>

      <div>
        <%= f.label :last_name, class: "label" %>
        <%= f.text_field :last_name, required: true, class: "input w-full", placeholder: "Rossi" %>
      </div>
    </div>

    <%# RIGA 2: Codice Fiscale e Data Nascita %>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full mt-2">
      <div>
        <%= f.label :fiscal_code, class: "label" %>
        <%= f.text_field :fiscal_code, required: true, class: "input w-full uppercase font-mono tracking-wide", placeholder: "RSSMRA..." %>
      </div>

      <div>
        <%= f.label :birth_date, class: "label" %>
        <%= f.date_field :birth_date, required: true, class: "input w-full" %>
      </div>
    </div>
  </fieldset>

  <%# --- SEZIONE 2: RESIDENZA (Novità Schema) --- %>
  <fieldset class="fieldset bg-base-100 border border-base-300 p-4 rounded-box shadow-sm">
    <legend class="fieldset-legend">
      <%= icon("home", size: 14) %>
      <%= t("members.form.sections.address", default: "Residenza") %>
    </legend>

    <%# Indirizzo Completo %>
    <div>
      <%= f.label :address, class: "label" %>
      <%= f.text_field :address, class: "input w-full", placeholder: "Via Roma, 10" %>
    </div>

    <%# Città e CAP %>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full mt-2">
      <div>
        <%= f.label :city, class: "label" %>
        <%= f.text_field :city, class: "input w-full", placeholder: "Milano" %>
      </div>

      <div>
        <%= f.label :zip_code, class: "label" %>
        <%= f.text_field :zip_code, class: "input w-full font-mono", placeholder: "20100" %>
      </div>
    </div>
  </fieldset>

  <%# --- SEZIONE 3: CONTATTI E INFO MEDICHE --- %>
  <fieldset class="fieldset bg-base-100 border border-base-300 p-4 rounded-box shadow-sm">
    <legend class="fieldset-legend">
      <%= icon("contact_mail", size: 14) %>
      <%= t("members.form.sections.details", default: "Contatti & Salute") %>
    </legend>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full">
      <div>
        <%= f.label :email_address, class: "label" %>
        <%= f.email_field :email_address, class: "input w-full", placeholder: "mario@esempio.com" %>
      </div>

      <div>
        <%= f.label :phone, class: "label" %>
        <%= f.telephone_field :phone, class: "input w-full", placeholder: "333 1234567" %>
      </div>
    </div>

    <div class="divider my-2"></div>

    <%# Certificato Medico %>
    <div>
      <%= f.label :medical_certificate_expiry, class: "label" %>
      <%= f.date_field :medical_certificate_expiry, class: "input w-full" %>

      <p class="label">
        <span class="label-text-alt text-base-content/60">
          Lasciare vuoto se non presente.
        </span>
      </p>
    </div>
  </fieldset>

  <%# --- AZIONI --- %>
  <div class="modal-action mt-8 flex items-center justify-end gap-2">
    <%= link_to t("actions.cancel"), members_path, class: "btn btn-ghost" %>

    <%= button_tag type: "submit", 
    class: "btn btn-primary", 
      data: { turbo_submits_with: '<span class="loading loading-dots loading-sm"></span> Salvataggio...' } do %>
      <%= icon("save", size: 18) %>
      <%= t("actions.save") %>
    <% end %>
  </div>
<% end %>
