<%
  # Logica visuale inline per lo stato (veloce e chiara)
  is_active = Date.current.between?(subscription.start_date, subscription.end_date)
  is_future = Date.current < subscription.start_date
  is_expired = Date.current > subscription.end_date
%>

<tr class="hover:bg-base-100 group">
  <td>
    <% if is_active %>
      <span class="badge badge-success gap-2 text-white font-bold">
        Attivo
      </span>
    <% elsif is_future %>
      <span class="badge badge-warning gap-2"> Futuro </span>
    <% else %>
      <span class="badge badge-ghost gap-2 opacity-50"> Scaduto </span>
    <% end %>
  </td>

  <td class="font-bold text-lg"><%= subscription.product.name %></td>

  <td>
    <div class="flex flex-col text-sm">
      <span class="font-mono <%= 'opacity-50' if is_expired %>">
        Dal: <%= l(subscription.start_date, format: :default) %>
      </span>

      <span class="font-mono font-bold <%= is_expired ? 'opacity-50' : 'text-primary' %>">
        Al: &nbsp;<%= l(subscription.end_date, format: :default) %>
      </span>
    </div>
  </td>

  <td class="text-center">
    <% if is_active %>
      <div class="stat-value text-xl text-success text-center">
        <%= (subscription.end_date - Date.current).to_i %>
      </div>
      <div class="text-[10px] uppercase tracking-wider opacity-60">
        Giorni rimasti
      </div>
    <% else %>
      <span class="opacity-30 text-xs font-mono">
        <%= (subscription.end_date - subscription.start_date).to_i %> gg tot
      </span>
    <% end %>
  </td>

  <td class="text-sm">
    <% if subscription.sale %>
      <div
        class="
          flex items-center gap-2 opacity-70 group-hover:opacity-100
          transition-opacity
        "
      >
        <%= icon("receipt_long", size: 16) %>

        <% if subscription.sale.receipt_code %>
          <span class="font-mono"><%= subscription.sale.receipt_code %></span>
        <% else %>
          <span><%= l(subscription.sale.created_at, format: :short) %></span>
        <% end %>
      </div>
    <% end %>
  </td>
</tr>
